{"version":3,"file":"src_app_pages_feat_websocket_websocket_module_ts.js","mappings":"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","sources":["./src/app/pages/feat/websocket/websocket-routing.module.ts","./src/app/pages/feat/websocket/websocket.component.ts","./src/app/pages/feat/websocket/websocket.component.html","./src/app/pages/feat/websocket/websocket.module.ts","./node_modules/rxjs/dist/esm/internal/observable/dom/WebSocketSubject.js","./node_modules/rxjs/dist/esm/internal/observable/dom/webSocket.js"],"sourcesContent":["import { NgModule } from '@angular/core';\r\nimport { RouterModule, Routes } from '@angular/router';\r\n\r\nimport { WebsocketComponent } from '@app/pages/feat/websocket/websocket.component';\r\n\r\nconst routes: Routes = [{ path: '', component: WebsocketComponent, data: { title: 'kiểm tra websocket', key: 'websocket' } }];\r\n\r\n@NgModule({\r\n  imports: [RouterModule.forChild(routes)],\r\n  exports: [RouterModule]\r\n})\r\nexport class WebsocketRoutingModule {}\r\n","import { Component, OnInit, ChangeDetectionStrategy, ChangeDetectorRef, OnDestroy } from '@angular/core';\r\n\r\nimport { ip, port } from '@env/environment.prod';\r\nimport { PageHeaderType } from '@shared/components/page-header/page-header.component';\r\nimport { webSocket } from 'rxjs/webSocket';\r\n\r\n@Component({\r\n  selector: 'app-websocket',\r\n  templateUrl: './websocket.component.html',\r\n  styleUrls: ['./websocket.component.less'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class WebsocketComponent implements OnInit, OnDestroy {\r\n  concate = true;\r\n  // https://github.com/ReactiveX/rxjs/issues/4166\r\n  pageHeaderInfo: Partial<PageHeaderType> = {\r\n    title: 'websocket',\r\n    breadcrumb: ['首页', '功能', 'websocket']\r\n  };\r\n  subject = webSocket(`ws://${ip}:8003/webSocket`);\r\n  result: string[] = [];\r\n  msg = '';\r\n\r\n  constructor(private cdr: ChangeDetectorRef) {}\r\n\r\n  send(): void {\r\n    this.subject.next(this.msg);\r\n    this.msg = '';\r\n  }\r\n\r\n  end(): void {\r\n    this.subject.complete();\r\n    this.concate = false;\r\n  }\r\n\r\n  ngOnInit(): void {}\r\n\r\n  ngAfterViewInit(): void {\r\n    this.subject.subscribe(res => {\r\n      // @ts-ignore\r\n      this.result.push(res.message);\r\n      this.result = [...this.result];\r\n      this.cdr.markForCheck();\r\n    });\r\n  }\r\n\r\n  ngOnDestroy(): void {\r\n    this.subject.complete();\r\n  }\r\n}\r\n","<app-page-header [pageHeaderInfo]=\"pageHeaderInfo\"></app-page-header>\r\n<div class=\"normal-table-wrap\">\r\n  <div nz-row [nzGutter]=\"[16, 16]\">\r\n    <div nz-col nzFlex=\"300px\">\r\n      <textarea class=\"m-b-8\" [(ngModel)]=\"msg\" nz-input placeholder=\"发送的内容服务端会返回\" [nzAutosize]=\"{ minRows: 3, maxRows: 5 }\"></textarea>\r\n      <button (click)=\"send()\" nz-button nzType=\"primary\">发送</button>\r\n      <button (click)=\"end()\" nz-button class=\"m-l-8\" nzType=\"default\">断开连接</button>\r\n      <span>链接状态：{{ concate }}</span>\r\n    </div>\r\n    <div nz-col nzFlex=\"auto\">\r\n      <nz-card nzTitle=\"消息内容\">\r\n        <ng-container *ngFor=\"let item of result\">\r\n          <div class=\"m-t-0 p-8 text-break m-b-8\" nz-result-content>\r\n            <span nz-typography>{{ item }}</span>\r\n          </div>\r\n          <div class=\"sp-12 text-right m-t-5\" nz-typography nzType=\"secondary\">已读</div>\r\n        </ng-container>\r\n      </nz-card>\r\n    </div>\r\n  </div>\r\n</div>\r\n","import { NgModule } from '@angular/core';\r\n\r\nimport { SharedModule } from '@shared/shared.module';\r\n\r\nimport { WebsocketRoutingModule } from './websocket-routing.module';\r\nimport { WebsocketComponent } from './websocket.component';\r\n\r\n@NgModule({\r\n  declarations: [WebsocketComponent],\r\n  imports: [SharedModule, WebsocketRoutingModule]\r\n})\r\nexport class WebsocketModule {}\r\n","import { Subject, AnonymousSubject } from '../../Subject';\nimport { Subscriber } from '../../Subscriber';\nimport { Observable } from '../../Observable';\nimport { Subscription } from '../../Subscription';\nimport { ReplaySubject } from '../../ReplaySubject';\nconst DEFAULT_WEBSOCKET_CONFIG = {\n    url: '',\n    deserializer: (e) => JSON.parse(e.data),\n    serializer: (value) => JSON.stringify(value),\n};\nconst WEBSOCKETSUBJECT_INVALID_ERROR_OBJECT = 'WebSocketSubject.error must be called with an object with an error code, and an optional reason: { code: number, reason: string }';\nexport class WebSocketSubject extends AnonymousSubject {\n    constructor(urlConfigOrSource, destination) {\n        super();\n        this._socket = null;\n        if (urlConfigOrSource instanceof Observable) {\n            this.destination = destination;\n            this.source = urlConfigOrSource;\n        }\n        else {\n            const config = (this._config = Object.assign({}, DEFAULT_WEBSOCKET_CONFIG));\n            this._output = new Subject();\n            if (typeof urlConfigOrSource === 'string') {\n                config.url = urlConfigOrSource;\n            }\n            else {\n                for (const key in urlConfigOrSource) {\n                    if (urlConfigOrSource.hasOwnProperty(key)) {\n                        config[key] = urlConfigOrSource[key];\n                    }\n                }\n            }\n            if (!config.WebSocketCtor && WebSocket) {\n                config.WebSocketCtor = WebSocket;\n            }\n            else if (!config.WebSocketCtor) {\n                throw new Error('no WebSocket constructor can be found');\n            }\n            this.destination = new ReplaySubject();\n        }\n    }\n    lift(operator) {\n        const sock = new WebSocketSubject(this._config, this.destination);\n        sock.operator = operator;\n        sock.source = this;\n        return sock;\n    }\n    _resetState() {\n        this._socket = null;\n        if (!this.source) {\n            this.destination = new ReplaySubject();\n        }\n        this._output = new Subject();\n    }\n    multiplex(subMsg, unsubMsg, messageFilter) {\n        const self = this;\n        return new Observable((observer) => {\n            try {\n                self.next(subMsg());\n            }\n            catch (err) {\n                observer.error(err);\n            }\n            const subscription = self.subscribe({\n                next: (x) => {\n                    try {\n                        if (messageFilter(x)) {\n                            observer.next(x);\n                        }\n                    }\n                    catch (err) {\n                        observer.error(err);\n                    }\n                },\n                error: (err) => observer.error(err),\n                complete: () => observer.complete(),\n            });\n            return () => {\n                try {\n                    self.next(unsubMsg());\n                }\n                catch (err) {\n                    observer.error(err);\n                }\n                subscription.unsubscribe();\n            };\n        });\n    }\n    _connectSocket() {\n        const { WebSocketCtor, protocol, url, binaryType } = this._config;\n        const observer = this._output;\n        let socket = null;\n        try {\n            socket = protocol ? new WebSocketCtor(url, protocol) : new WebSocketCtor(url);\n            this._socket = socket;\n            if (binaryType) {\n                this._socket.binaryType = binaryType;\n            }\n        }\n        catch (e) {\n            observer.error(e);\n            return;\n        }\n        const subscription = new Subscription(() => {\n            this._socket = null;\n            if (socket && socket.readyState === 1) {\n                socket.close();\n            }\n        });\n        socket.onopen = (evt) => {\n            const { _socket } = this;\n            if (!_socket) {\n                socket.close();\n                this._resetState();\n                return;\n            }\n            const { openObserver } = this._config;\n            if (openObserver) {\n                openObserver.next(evt);\n            }\n            const queue = this.destination;\n            this.destination = Subscriber.create((x) => {\n                if (socket.readyState === 1) {\n                    try {\n                        const { serializer } = this._config;\n                        socket.send(serializer(x));\n                    }\n                    catch (e) {\n                        this.destination.error(e);\n                    }\n                }\n            }, (err) => {\n                const { closingObserver } = this._config;\n                if (closingObserver) {\n                    closingObserver.next(undefined);\n                }\n                if (err && err.code) {\n                    socket.close(err.code, err.reason);\n                }\n                else {\n                    observer.error(new TypeError(WEBSOCKETSUBJECT_INVALID_ERROR_OBJECT));\n                }\n                this._resetState();\n            }, () => {\n                const { closingObserver } = this._config;\n                if (closingObserver) {\n                    closingObserver.next(undefined);\n                }\n                socket.close();\n                this._resetState();\n            });\n            if (queue && queue instanceof ReplaySubject) {\n                subscription.add(queue.subscribe(this.destination));\n            }\n        };\n        socket.onerror = (e) => {\n            this._resetState();\n            observer.error(e);\n        };\n        socket.onclose = (e) => {\n            if (socket === this._socket) {\n                this._resetState();\n            }\n            const { closeObserver } = this._config;\n            if (closeObserver) {\n                closeObserver.next(e);\n            }\n            if (e.wasClean) {\n                observer.complete();\n            }\n            else {\n                observer.error(e);\n            }\n        };\n        socket.onmessage = (e) => {\n            try {\n                const { deserializer } = this._config;\n                observer.next(deserializer(e));\n            }\n            catch (err) {\n                observer.error(err);\n            }\n        };\n    }\n    _subscribe(subscriber) {\n        const { source } = this;\n        if (source) {\n            return source.subscribe(subscriber);\n        }\n        if (!this._socket) {\n            this._connectSocket();\n        }\n        this._output.subscribe(subscriber);\n        subscriber.add(() => {\n            const { _socket } = this;\n            if (this._output.observers.length === 0) {\n                if (_socket && (_socket.readyState === 1 || _socket.readyState === 0)) {\n                    _socket.close();\n                }\n                this._resetState();\n            }\n        });\n        return subscriber;\n    }\n    unsubscribe() {\n        const { _socket } = this;\n        if (_socket && (_socket.readyState === 1 || _socket.readyState === 0)) {\n            _socket.close();\n        }\n        this._resetState();\n        super.unsubscribe();\n    }\n}\n","import { WebSocketSubject } from './WebSocketSubject';\nexport function webSocket(urlConfigOrSource) {\n    return new WebSocketSubject(urlConfigOrSource);\n}\n"],"names":["Subject","AnonymousSubject","Subscriber","Observable","Subscription","ReplaySubject","DEFAULT_WEBSOCKET_CONFIG","url","deserializer","e","JSON","parse","data","serializer","value","stringify","WEBSOCKETSUBJECT_INVALID_ERROR_OBJECT","WebSocketSubject","constructor","urlConfigOrSource","destination","_socket","source","config","_config","Object","assign","_output","key","hasOwnProperty","WebSocketCtor","WebSocket","Error","lift","operator","sock","_resetState","multiplex","subMsg","unsubMsg","messageFilter","self","observer","next","err","error","subscription","subscribe","x","complete","unsubscribe","_connectSocket","protocol","binaryType","socket","readyState","close","onopen","evt","openObserver","queue","create","send","closingObserver","undefined","code","reason","TypeError","add","onerror","onclose","closeObserver","wasClean","onmessage","_subscribe","subscriber","observers","length","webSocket"],"sourceRoot":"webpack:///","x_google_ignoreList":[4,5]}